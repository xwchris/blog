---
title: "CSS内联元素深入理解"
date: "2019-05-04"
tags: css
author: xwchris
desc: "在前端开发中，似乎控制不同大小文字之间，或者文字与图标之间对齐总是不那么得心应手，总觉得少了点什么，这其中其实跟CSS中几种跟内联元素相关的属性有很大的关系，从我的感觉看，平时遇到的30%的css问题都是由于搞不清这几种属性的关系有关"
---

首先我们要从介绍字体开始，掌握相关概念。

技术是以目的为导向的，那么先来抛出一个问题，前端开发中我们使用`font-size`来设置文字的大小，但检查元素后发现内联元素的高好像大多数时间并不是我们设置的`font-size`大小，这是为什么哪？

这里面涉及到浏览器的影响，字体的设计等方面的知识。尤其是字体设计是一门高深的学问，而我们只是为了开发网页中控制文字大小和对齐，所以这里我们只取我们需要的部分，下面先介绍字体概念。

## 字体相关概念
我们先来了解文字的各个概念。图看起来更直观，所以我简单画了个图。

![645884385-5ad4b84063b4f_articlex](https://user-images.githubusercontent.com/13817144/38925840-52a2c0c6-4333-11e8-9cd8-297749724fa6.png)

### 基线
对照着图，可以看出基线是位于字母`x`下方的那条线，所有字符都基于这条线进行定位。这应该大家比较常见，毕竟`vertical-align`的默认值就是`baseline`，指的就是这条线。

### em-box
`em-box`可能比较少见，但大家一定知道单位`em`。`1em`跟该元素的`font-size`大小相同。还是以图为例如果设置`font-size: 20px`，那么`em-box`的高度就为`20px`。

### content-area
这是一个很重要的概念，`content-area`翻译成中文是内容区域，这里图中没有标出，因为通常默认情况下，`content-area`与`line-height`是一样高的。给一个内联元素设置背景，这背景所占的区域就可以看成内容区域。

大多数情况下`content-area`于`em-box`的高度不同，`content-area`的高度受到`font-family`和`font-size`的影响，有时候即使`font-size`一致可能只是因为字体不同导致`content-area`也不一样，这是在字体设计的时候就决定了的。而`em-box`只受`font-size`影响。这也就解释了为什么我们有时候检查元素看到的高度与实际字体设置大小不一样的问题。

### 半行距
先看行距怎么算，`行距 = line-height - font-size`。半行距就是将行距一分为二，一份加在`em-box`的上面，一份加在下面，就构成了完整的文字高度。

### x-height
`x-height`顾名思义就是`x`字符高度的意思，`1ex`就是`x-height`的值，通常没什么作用，但是对于我们理解概念有很大帮助，css中`vertical-align: middle`的解释就是Aligns the middle of the element with the baseline plus half the x-height of the parent，意思就是将该元素的中心点与父元素基线加上`x-height`高度的一半对齐。

这句话里有几个关键的部分一定要弄明白`该元素的中心点`、`父元素的基线`和`基线加上x-height高度的一半`，我们常常使用`veritcal-align: middle`出错，往往就是这几个点没有搞清楚，这里先试着理解，以后的文章会详细说明。


以下部分是介绍字体单位和一些理解，如果已经了解可以直接跳过，别浪费时间，时间宝贵~

## 度量单位
字体的大小在css中用`font-size`来表示，它的度量单位有很多，主要分为三大类：关键词类型、数值类型、百分比类型。

### 关键词类型
关键词类型分为绝对尺寸和相对尺寸。由于使用的较少，不必记忆，所以这里仅仅罗列出来。

绝对尺寸：`xx-small`、`x-small`、`small`、`medium`、`large`、`x-large`、`xx-large`。

相对类型：`smaller`、`larger`。

### 数值类型
数值类型在平时使用较多，而数值类型的单位常用的有`px`、`em`和`rem`，可能偶尔会用到`ex`其他基本用不到，不再列举。`px`表示像素，`em`是相对于父元素的字体进行计算，而`rem`则是相对于根元素`<html>`的字体大小进行计算。

## 其他应用

### 神奇的font-size: 0
`font-size: 0`这种写法很常用，如果出现不能调整为0的情况，可以在浏览器设置里面进行调整。使用`font-size: 0`让字体大小变为0，通常也会使得`line-hight`变为0，这经常可以解决`line-block`元素出现的空隙问题，这个问题具体的原因我们后面再说。

看了很多文章最后总结和整理了这些，下一篇介绍`line-height`说说`line-height`在内联元素中的作用。在这篇文章中如有错误或我与大家理解不一致的地方，欢迎指出，感谢~[原文链接](https://github.com/xwchris/blog/issues/13)。

刚才我们讨论了`font-size`，下面来说另一个与文字关系密切的属性`line-height`。先来说下内联盒模型概念，然后是度量单位，最后来聊一个常见的内联元素的现象。

## 内联盒模型相关概念
说到盒模型，只要了解css的基本都知道这个概念，但说到内联盒模型可能很多人不是特别清楚。现在我们就来说说内联盒模型几个重要的概念。先看图概览一下，再逐项往下看。

![image](https://user-images.githubusercontent.com/13817144/38943440-024647de-4364-11e8-8fcd-a2037a045608.png)

Tip: 图中用不同颜色的框标注了很多框，这些代表我们下面要说的不同的盒子或不同的概念。

### inline-box
`inline-box`又名内联盒子，通常由一些标签包裹形成，最常用的如`<span>`标签包裹文字会形成内联盒子，那些没有标签包裹的文字默认自己形成一个盒子称为`anonymous inline box`匿名内联盒子。

### line-box
`line-box`名为行框，从名字就可以看出，它是由单行内联元素形成的一个区域，注意是每一行都会形成，如果文字由五行，就会形成5个行框。行框的高度基本上是由行框中行高最大的内联盒子决定的。我使用基本上这个词，是因为还有其他情况，比如受到`vertical-align`属性的影响。

### containing-box
`container-box`就是包含块的意思，在内联元素中，包含块是由行框组成的。说白了就是包裹在所有行框外面的那层盒子。

### struct
这个词可能很多同学见的比较少，张鑫旭的文章里称之为”幽灵空白节点“，我们这里就用其英文名称`struct`

在CSS规范中有这么一句话

> Each line box starts with a zero-width inline box with the element's font and line-height properties. We call that imaginary box a ”struct"

意思就是每一个行框开始的位置都有一个宽度为0，并且行高和字体大小都与该元素相同的内联盒子。这个假想的内联盒子就被称为struct。简单可以理解为行框前面的一个宽为0的空字符。

可能有的人会问，这个东西有什么用那？(⊙v⊙)嗯，用处大了去了，由于其几乎无处不在的特性并且由于宽度为0，我们平时在内联元素中遇到的很多奇怪的问题都是由`struct`引起的。我们暂时先放下这个，文章的最后我们再看这个东西引发的问题。

## 度量单位
这一部分说说行高的单位，我们不再列出所有的单位，因为这些完全可以从官方文档上看到，我们这里只说说重要的或者说容易错的部分。

### 默认值
`line-height`的默认值是什么，查下手册我们就能很容易的看到，它的值是`normal`，那么`normal`是多大？从我的理解来说，它的值受到`font-family`和浏览器的影响，IE/Firfox与chorme表现存在部分不一样的地方。但可以知道的是`normal`的初始值与字体的`content-area`的区域高度相同。不了解`content-area`的同学可以去看我的[上一篇](https://github.com/xwchris/blog/issues/13)文章的`line-height`部分。这里简单说一下，`inline`水平的元素设置背景后，背景部分就是内容区域的部分，与初始`line-height`同高。

### 百分比、em和数值的区别
百分比和em与数值的区别在于继承性质上的不同，百分比和em被继承的是计算后的值，而数值类型的继承的是一种“计算规则”。

## 常见问题
这一部分我们来说一说常见的内联元素的一些问题。

### display: inline-block元素间的空隙
这个问题，大家都遇到过，大家可以看看我做的[实例](https://codepen.io/xwchris/pen/deoLwO)的第一部分。首先我们会看到元素和元素之间的一定的间隙。这个间隙会引发的问题有，如果我们设置两个`display: inline-block`的元素宽度为`width: 50%`都向右或向左浮动，但是确无法排在一行的情况。这就是由于多出了这一点间隙，导致容器宽度不足，最后容器一行无法放不下两个宽度都为容器一半宽度的元素。

有人可能觉得这些元素间的间隙比较奇怪，但这是一种正常现象，因为内联元素本来的排版就应该有间隙，你能够想象文字和文字之间没有间隙的情况吗？内联元素之间本来就应该独立分开。怎么解决这个问题，网上也有很多答案，这里只简单提一下，因为我们主要说的是原理嘛。通过设置`font-size`为0，或者使用`letter-spacing`属性，都可以达到去除内联元素之间的间隙的目的。

在我[实例](https://codepen.io/xwchris/pen/deoLwO)第一部分中应该很多人也注意到，在父容器的最底端也有一个空隙，这个到底是什么那？还记得我上面概念中提到的`struct`吗，这种现象就是由这个东西引起的，由于其不可见，所有我们用一个内联元素`x`来代替。这里可以看[实例](https://codepen.io/xwchris/pen/deoLwO)的第二部分。这个现象的原因是由于内联元素是默认`vertical-align: baseline`对齐的，而我们的内联元素的基线是默认为元素的底边缘，`sturct`又有自己的行高，当它的基线与我们的内联元素对齐时，它的行高会撑起一部分距离，就出现了实例中的现象。

知道了原因，我们解决起来也很简单。只要`struct`元素的行高为0就可以了，所以我们可以设置父元素的`line-height: 0`或者通过设置`font-size: 0`来间接设置`line-height`为0。可能已经有人发现，`font-size: 0`可以同时解决元素间的间隙和底部的间隙，所以我更喜欢用这个方法。

下面我们做一下其他的操作，我们在[实例](https://codepen.io/xwchris/pen/deoLwO)第三部分中，前面三个`inline-block`元素中加上文字，发现元素都往下移动了，这又是什么原理那。这其中就涉及到了`vertical-align`属性的一些性质，下一部分就来讲讲`vertical-align`，并且来说说这种现象的原因。

从头到尾，我们都试图在梳理清楚内联元素中一些较为重要的概念，其中一个很主要的目的，就是为了解决内联元素的对齐问题。对于很多前端开发来说，对齐问题一直是一个非常常见，但有时候又让我们感到非常困惑的问题。在这篇文章里我会用最简洁的解释来解释内联元素到底是怎么回事。这篇换个形式，我们用几个问答来说明关键问题。

## 内联元素的对齐主要由哪些属性影响
我们以下所说的对齐主要是针对内联元素的。我们都知道CSS最后展现在界面中的结果，经常是由多个属性共同作用的结果。对齐主要是由`font-size`，`line-height`和`vertical-align`这三个属性共同作用的结果，这也是为什么我分了三篇来讲。

## 内联水平元素的baseline是什么
`vertical-align`属性有非常多的值，它的默认值是`baseline`即相对于基线对齐。基线的概念我们在[font-size](www.baidu.com)那部分也说过，那里解释的是文字的基线。那么对于一个`display: inline-block`，并且拥有固定宽和高的元素来说，它的基线是什么那？我可能问了一个很蠢的问题，很多人应该都知道，它的基线就是其`margin-box`即该元素的底部边界（包括margin）。如图所示，

![image](https://user-images.githubusercontent.com/13817144/55063668-71324a00-50b3-11e9-8f87-906d552a3eff.png)

但是如果在该元素中其中加入文字，它的基线还是底边界吗？实践出真知，我们还是用[实例](https://codepen.io/xwchris/pen/vjrgrE)来看下。

![image](https://user-images.githubusercontent.com/13817144/39965395-77358518-56ca-11e8-8724-c04ba573e304.png)

这种情况这个在css2.1规范里有提及

> The baseline of an 'inline-block' is the baseline of its last line box in the normal flow, unless it has either no in-flow line boxes or if its 'overflow' property has a computed value other than 'visible', in which case the baseline is the bottom margin edge

意思就是`inline-block`如果有`overflow`非`visible`的属性或者没有其中任何行盒那么它的基线就是底部的margin边界否则的话它的基线就是其中最后一个行盒的基线。(tip: 行盒的概念在第一篇文章中也有介绍)。

## 实例
下面我们要实现一个定宽高的div在容器中垂直水平居中的效果，当然有很多方法，我们这里只利用内联元素的特性来实现，来说明内联元素的对齐原理，[点我看实例](https://codepen.io/xwchris/pen/gzKmMR)。

先来看实例中的第一个，我们将box元素设置为`inline-block`水平，然后使用`text-align: center`让其水平居中，(base元素中x用来辅助观察父容器的基线位置，实际应用中不应该存在)，然后将box的`text-align`属性设置为`vertical-align: middle`。emm...，然而并没有垂直居中，这是为什么哪？

![image](https://user-images.githubusercontent.com/13817144/39965940-69337668-56d5-11e8-8efe-449df111159b.png)

这里我们首先要知道`vertical-align: middle`是相对于谁来对齐，前面的文章也提到过，`vertical-align: middle`是会将元素的中心点与父容器基线向上1/2`x-height`的位置对齐。在我们第一个例子中，随着我们设置`vertical-align`的值，父容器的基线位置在不停的变化。由于我们要实现垂直居中的效果，所有我们需要父容器的的基线能够在容器的中央。

现在我们需要使用一个辅助元素将父容器的基线撑开，这里使用父容器的`:after`伪元素来做一个辅助元素，具体看实例的第二个设置其高与父容器一致，并设置其`veritcal-align: middle`。这样父容器的基线就会在容器垂直正中央偏下1/2`x-height`的位置，box的中心线与基线加上1/2的位置对齐，正好在中央。现在垂直居中已经实现了。

![image](https://user-images.githubusercontent.com/13817144/39965944-7563cf50-56d5-11e8-9545-f9591ab0b5a3.png)

但是我们这里还有一个问题，仔细观察会发现该box元素水平并没有完全水平居中。给辅助元素设置了`1px`宽度和背景颜色后我们很容易看出问题原因，这是由于内联元素间的间隙造成的。要解决这个间隙，我们使用最简单的方法，设置父容器的`font-size: 0`，最后我们的水平垂直居中效果如实例中第三个所示。

![image](https://user-images.githubusercontent.com/13817144/39965947-8a74194a-56d5-11e8-9b84-508161afc065.png)

## 总结
到这篇文章为止，关于内联元素几个比较重要的属性以及内联元素对齐的知识也差不多讲完了，可能里面还有一些很细节的部分没有说到，这就要大家以后多多发挥google的功效了。

初始学习css，感觉css是一个非常简单的东西，一天就能用css写出一些网页效果。但当慢慢深入的时候，会发现这是一个非常非常复杂的东西，这才是真正实践了什么叫”入门容易，精通难“。这是我自己学习css到现在一个最大的感受。总之，css学习之路还有很长，前端之路学习之路还有很长。当真正能够独立解决并解释所有别人提出的所以前端方面的问题，或许是前端无敌吧。又写了些废话，突然有感而发，这里与诸君共勉之~，共同努力

